<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Photo Booth Advanced BI</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap');

        body {
            font-family: "SF Pro Display", system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
            background-color: #f1f5f9;
        }

        .stat-card {
            background: white;
            border-radius: 12px;
            border-top-left-radius: 0;
            border-bottom-left-radius: 0;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
            transition: transform 0.2s;
        }

        .stat-card:hover {
            transform: translateY(-2px);
        }

        .hkt-badge {
            background: #1e293b;
            color: #f8fafc;
            padding: 2px 8px;
            border-radius: 4px;
            font-size: 0.7rem;
        }

        .insight-pill {
            background: #e0f2fe;
            color: #0369a1;
            padding: 4px 12px;
            border-radius: 9999px;
            font-size: 0.75rem;
            font-weight: 600;
        }
    </style>
</head>

<body class="p-4 md:p-8">
    <div class="max-w-7xl mx-auto">
        <header class="flex flex-col md:flex-row justify-between items-end mb-8 gap-4">
            <div>
                <div class="flex items-center gap-3 mb-1">
                    <h1 class="text-3xl font-black text-slate-900 tracking-tight">Computer Records</h1>
                    <span class="hkt-badge">20 Dec 2025</span>
                </div>
                <p class="text-slate-500">Logs by the computer cloud.</p>
            </div>
            <div class="w-full md:w-auto">
                <textarea id="jsonInput"
                    class="w-full md:w-96 h-20 p-3 border border-slate-300 rounded-lg text-xs font-mono focus:ring-2 focus:ring-indigo-500 outline-none"
                    placeholder="Paste raw session JSON here..."></textarea>
                <button onclick="processData()"
                    class="mt-2 w-full bg-slate-900 text-white py-2.5 rounded-lg font-bold hover:bg-indigo-600 transition-all shadow-lg">Run
                    Business Audit</button>
            </div>
        </header>

        <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-8">
            <div class="stat-card p-5 border-l-4 border-indigo-500">
                <p class="text-xs font-bold text-slate-400 uppercase tracking-wider">Est. Gross Revenue</p>
                <h2 id="totalIncome" class="text-3xl font-black text-slate-800">$0</h2>
                <div id="revenueInsight" class="mt-2 text-xs text-green-600 font-semibold"></div>
            </div>
            <div class="stat-card p-5 border-l-4 border-emerald-500">
                <p class="text-xs font-bold text-slate-400 uppercase tracking-wider">Upsell Rate (Digital)</p>
                <h2 id="upsellRate" class="text-3xl font-black text-slate-800">0%</h2>
                <p class="text-xs text-slate-400 mt-1">Goal: >35%</p>
            </div>
            <div class="stat-card p-5 border-l-4 border-amber-500">
                <p class="text-xs font-bold text-slate-400 uppercase tracking-wider">Bundle Attachment</p>
                <h2 id="bundleRate" class="text-3xl font-black text-slate-800">0%</h2>
                <p class="text-xs text-slate-400 mt-1">Print + Digital combos</p>
            </div>
            <div class="stat-card p-5 border-l-4 border-rose-500">
                <p class="text-xs font-bold text-slate-400 uppercase tracking-wider">RPS (Rev Per Session)</p>
                <h2 id="avgRevenue" class="text-3xl font-black text-slate-800">$0.00</h2>
                <p class="text-xs text-slate-400 mt-1">Efficiency metric</p>
            </div>
        </div>

        <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
            <div class="lg:col-span-2 stat-card p-6">
                <div class="flex justify-between items-center mb-6">
                    <h3 class="text-lg font-bold text-slate-800">Product Performance Matrix</h3>
                    <div class="flex gap-2">
                        <span class="insight-pill" id="topFramePill">Top: N/A</span>
                    </div>
                </div>
                <canvas id="frameChart" height="120"></canvas>
            </div>

            <div class="stat-card p-6">
                <h3 class="text-lg font-bold text-slate-800 mb-4">Consumer Bundle Preference</h3>
                <canvas id="bundlePie" class="mb-4"></canvas>
                <div id="bundleLegend" class="space-y-2 text-sm text-slate-600">
                </div>
            </div>
        </div>

        <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 mt-8">
            <div class="stat-card p-6">
                <h3 class="text-lg font-bold text-slate-800 mb-6">Traffic & Revenue Velocity (Hourly)</h3>
                <canvas id="timeChart" height="150"></canvas>
            </div>

            <div class="stat-card p-6">
                <h3 class="text-lg font-bold text-slate-800 mb-4">Navigator Sales Proficiency</h3>
                <div class="overflow-x-auto">
                    <table class="w-full text-left text-sm">
                        <thead class="text-slate-400 font-bold uppercase text-[10px] border-b">
                            <tr>
                                <th class="pb-2">Navigator</th>
                                <th class="pb-2">Sessions</th>
                                <th class="pb-2">Upsell %</th>
                                <th class="pb-2">Rev/Session</th>
                            </tr>
                        </thead>
                        <tbody id="navTable" class="divide-y divide-slate-50">
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <script>
        let charts = {};

        function processData() {
            let data;
            try {
                const input = document.getElementById('jsonInput').value;
                if (!input) return;
                data = JSON.parse(input);
            } catch (e) { alert('Invalid JSON'); return; }

            const analysis = {
                total: 0,
                revenue: 0,
                bundles: { full: 0, printOnly: 0, digitalOnly: 0, bounce: 0 },
                frames: {},
                navigators: {},
                hourly: {}
            };

            data.forEach(item => {
                if (!item.participated) return;
                analysis.total++;

                const isPrint = !!item.print;
                const isPurchase = !!item.purchase;
                const rev = (isPrint ? 20 : 0) + (isPurchase ? 10 : 0);
                analysis.revenue += rev;

                // Bundle Logic
                if (isPrint && isPurchase) analysis.bundles.full++;
                else if (isPrint) analysis.bundles.printOnly++;
                else if (isPurchase) analysis.bundles.digitalOnly++;
                else analysis.bundles.bounce++;

                // Navigator Analysis
                const nav = item.navigator || 'Guest';
                if (!analysis.navigators[nav]) analysis.navigators[nav] = { count: 0, rev: 0, upsells: 0 };
                analysis.navigators[nav].count++;
                analysis.navigators[nav].rev += rev;
                if (isPurchase) analysis.navigators[nav].upsells++;

                // Frame Analysis
                const frame = item.frame || 'Standard';
                if (!analysis.frames[frame]) analysis.frames[frame] = { count: 0, rev: 0, upsells: 0 };
                analysis.frames[frame].count++;
                analysis.frames[frame].rev += rev;
                if (isPurchase) analysis.frames[frame].upsells++;

                // Time Analysis
                const hour = new Intl.DateTimeFormat('en-GB', { timeZone: 'Asia/Hong_Kong', hour: '2-digit' }).format(new Date(item.participated));
                if (!analysis.hourly[hour]) analysis.hourly[hour] = { count: 0, rev: 0 };
                analysis.hourly[hour].count++;
                analysis.hourly[hour].rev += rev;
            });

            updateUI(analysis);
        }

        function updateUI(s) {
            // Metrics
            document.getElementById('totalIncome').textContent = `$${s.revenue.toLocaleString()}`;
            document.getElementById('avgRevenue').textContent = `$${(s.revenue / s.total || 0).toFixed(2)}`;
            const upsellRate = (s.bundles.digitalOnly + s.bundles.full) / s.total * 100 || 0;
            document.getElementById('upsellRate').textContent = `${upsellRate.toFixed(1)}%`;
            const bundleRate = (s.bundles.full / s.total * 100 || 0);
            document.getElementById('bundleRate').textContent = `${bundleRate.toFixed(1)}%`;

            // Charting - Product Matrix
            const frameLabels = Object.keys(s.frames);
            renderChart('frameChart', 'bar', {
                labels: frameLabels,
                datasets: [
                    { label: 'Revenue ($)', data: frameLabels.map(f => s.frames[f].rev), backgroundColor: '#6366f1' },
                    { label: 'Upsell Count', data: frameLabels.map(f => s.frames[f].upsells), backgroundColor: '#a855f7' }
                ]
            });

            // Charting - Bundle Pie
            renderChart('bundlePie', 'doughnut', {
                labels: ['Full Bundle', 'Print Only', 'Digital Only', 'No Purchase'],
                datasets: [{
                    data: [s.bundles.full, s.bundles.printOnly, s.bundles.digitalOnly, s.bundles.bounce],
                    backgroundColor: ['#10b981', '#3b82f6', '#f59e0b', '#cbd5e1']
                }]
            });

            // Charting - Velocity
            const hours = Object.keys(s.hourly).sort();
            renderChart('timeChart', 'line', {
                labels: hours,
                datasets: [
                    { label: 'Revenue Velocity', data: hours.map(h => s.hourly[h].rev), borderColor: '#6366f1', fill: true, tension: 0.4 },
                    { label: 'Session Density', data: hours.map(h => s.hourly[h].count), borderColor: '#f43f5e', borderDash: [5, 5] }
                ]
            });

            // Navigator Table
            const navRows = Object.entries(s.navigators).sort((a, b) => b[1].rev - a[1].rev).map(([name, data]) => `
                <tr>
                    <td class="py-3 font-bold text-slate-700">${name}</td>
                    <td class="py-3 text-slate-500">${data.count}</td>
                    <td class="py-3">
                        <span class="px-2 py-1 rounded text-xs font-bold ${data.upsells / data.count > 0.4 ? 'bg-green-100 text-green-700' : 'bg-slate-100 text-slate-600'}">
                            ${(data.upsells / data.count * 100).toFixed(1)}%
                        </span>
                    </td>
                    <td class="py-3 font-mono font-bold">$${(data.rev / data.count).toFixed(2)}</td>
                </tr>
            `).join('');
            document.getElementById('navTable').innerHTML = navRows;

            // Smart Insights
            const topFrame = Object.entries(s.frames).reduce((a, b) => a[1].rev > b[1].rev ? a : b)[0];
            document.getElementById('topFramePill').textContent = `Star: ${topFrame}`;
        }

        function renderChart(id, type, data) {
            if (charts[id]) charts[id].destroy();
            charts[id] = new Chart(document.getElementById(id), {
                type: type,
                data: data,
                options: {
                    responsive: true,
                    maintainAspectRatio: true,
                    plugins: { legend: { display: type === 'doughnut', position: 'bottom' } }
                }
            });
        }
    </script>
</body>

</html>